<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>Resque to Sidekiq | TheWorkAround</title> <meta name="generator" content="Jekyll v3.8.5"/> <meta property="og:title" content="Resque to Sidekiq"/> <meta name="author" content="Brandon Hicks"/> <meta property="og:locale" content="en_US"/> <meta name="description" content="Background processing with SideKiq"/> <meta property="og:description" content="Background processing with SideKiq"/> <link rel="canonical" href="http://theworkaround.com/2014/10/29/resque-to-sidekiq.html"/> <meta property="og:url" content="http://theworkaround.com/2014/10/29/resque-to-sidekiq.html"/> <meta property="og:site_name" content="TheWorkAround"/> <meta property="og:type" content="article"/> <meta property="article:published_time" content="2014-10-29T00:00:00-06:00"/> <script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"http://theworkaround.com/2014/10/29/resque-to-sidekiq.html"},"url":"http://theworkaround.com/2014/10/29/resque-to-sidekiq.html","headline":"Resque to Sidekiq","dateModified":"2014-10-29T00:00:00-06:00","datePublished":"2014-10-29T00:00:00-06:00","description":"Background processing with SideKiq","author":{"@type":"Person","name":"Brandon Hicks"},"@type":"BlogPosting","@context":"https://schema.org"}</script> <meta name="title" content="Resque to Sidekiq | TheWorkAround"> <meta name="keywords" content="ruby,rails,redis"> <meta name="google" content="notranslate"> <meta name="robots" content="index, follow"> <meta http-equiv="Content-Language" content="en"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <link rel="preconnect" href="https://fonts.googleapis.com/" crossorigin> <link rel="preconnect" href="https://www.google-analytics.com/" crossorigin> <link rel="preconnect" href="https://ajax.googleapis.com/" crossorigin> <link rel="preconnect" href="https://cdnjs.cloudflare.com/" crossorigin> <link rel="dns-prefetch" href="https://fonts.googleapis.com/"> <link rel="dns-prefetch" href="https://www.google-analytics.com/"> <link rel="dns-prefetch" href="https://ajax.googleapis.com/"> <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com/"> <meta name="theme-color" content="#4cb8c4"> <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous"> <link rel="stylesheet" href="/assets/stylesheets/app-a09f5d095871465ede6b58bcd69c865d37a9decae5f0de1f17b636e1913e8966.css" integrity="sha256-oJ9dCVhxRl7ea1i81pyGXTep3srl8N4fF7Y24ZE+iWY=" crossorigin="anonymous"> <!--[if lt IE 9]><script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script> <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]--> <!--[if lte IE 8]><script src="https://cdnjs.cloudflare.com/ajax/libs/ie8/0.8.0/ie8.js"></script><![endif]--> <link href="/atom.xml" rel="alternate" title="Atom" type="application/atom+xml"> <link href="/rss.xml" rel="alternate" title="RSS" type="application/rss+xml"> <link href="/sitemap.xml" rel="sitemap" title="Sitemap" type="application/xml"> <link href="/humans.txt" rel="author" type="text/plain"> </head> <body> <div class="container-fluid"> <div class="site"> <div class="row"> <div class="col-md-2"> <div class="social-icons d-flex justify-content-around justify-content-md-end"> <a href="/" title="Return to Homepage" class="mx-2">/</a> <a href="http://twitter.com/tarellel" title="Follow me on Twitter" class="mx-2" rel="me"> <em class="fab fa-twitter"></em> </a> <a href="http://github.com/tarellel" title="View my code on GitHub" class="mx-2" rel="me"> <em class="fab fa-github"></em> </a> <a href="mailto:&#116;&#097;&#114;&#101;&#108;&#108;&#101;&#108;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;" title="Email Me" class="mx-2" rel="email"> <em class="fa fa-envelope"></em> </a> </div> <div class="text-right navlinks d-flex justify-content-around flex-md-column p-0 my-2"> <a href="/about" class="nav-items my-sm-3 my-md-0">About</a> <a href="/archive" class="nav-items my-sm-3 my-md-0">Archive</a> </div> </div> <div class="col-md-10 px-3"> <h1 class="post-title">Resque to Sidekiq</h1> <div class="row"> <div class="d-flex align-self-center w-100 px-3 py-0 mb-xs-3"> <p class="meta w-50 my-1">Oct 29, 2014</p> <div class="w-50 text-right"> Tags: <a href="/tag/ruby/" rel="tag">ruby</a>, <a href="/tag/rails/" rel="tag">rails</a>, <a href="/tag/redis/" rel="tag">redis</a> </div> </div> </div> <div class="post"> <p>Background processing is an important feature with any web application to improve performance. Not only does it free up your application for requests, it can be used to prioritize tasks and delay processes until your system has available resources.</p> <p>This post is not about <a href="https://github.com/collectiveidea/delayed_job">delayed_job</a>, <a href="https://kr.github.io/beanstalkd/">beanstalkd</a>, <a href="https://github.com/mperham/girl_friday">girl_friday</a>, <a href="https://github.com/brandonhilkert/sucker_punch">sucker_punch</a>, or a <a href="https://www.ruby-toolbox.com/categories/Background_Jobs">wide selection</a> of other background processors. Even though I’ve used delayed_job which is amazingly easy to setup and use, I don’t exactly want to clog up my ActiveRecord database with database queries. The use of a key-value store tends to make things fast and simple as it is. For background jobs, caching, and various other tasks Redis does an amazing job: it’s fast, reliable, and does over complicate the application.</p> <p>Until recently I had been using <a href="https://github.com/resque/resque">Resque</a> the Holy Grail of Ruby based background processors and it has worked flawlessly to the needs I required. But one of the applications I have setup allows users to upload as many images (using <a href="https://github.com/carrierwaveuploader/carrierwave">Carrierwave</a>) as they want at any given time. Upon the successful upload of these images the files mime-types and extensions are verified to ensure that malicous files aren’t being uploaded to the server. Than the images are processed to create thumbnails, gallery images, etc. and when you’re processing numerous image files at one time without background processing this absolutely bogs down a server. When you have some a mechanism to do this effecively in the background this doesn’t have such a huge impact. But as of lately with a higher user base the image uploads have begin to display delayes in their processing times.</p> <p>It may not seem like much, but when it’s a few images here and there from numerous users at any given time, the processing time begins to add up. Especially when upon upload a thumbnail is generated and expected to be displayed almost immediately showing the available uploads for use.</p> <p>One great thing about Sidekiq is that just like Resque it uses <a href="http://redis.io/">Redis</a>, if you’ve never used Redis before, please do us all a favor and at least give a quick try. Compared to large SQL databases it’s very simple (key/value pair) and extremely fast, <a href="https://github.com/redis-store/redis-rails">some people</a> have gone as far to use it for caching, sessions, and various other tasks.</p> <p>The amazing part that makes this migration from Resque to Sidekiq fast and easy is that both libraries use Redis as their backend database to keep track of queues/tasks. A lot of the gems and initializers just require that you to change the backend from resque to sidekiq, while others just adjust to detecting what’s available.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># carrierwave_backgrounder</span>
<span class="n">c</span><span class="p">.</span><span class="nf">backend</span> <span class="ss">:resque</span>
<span class="n">c</span><span class="p">.</span><span class="nf">backend</span> <span class="ss">:sidekiq</span>

<span class="c1"># devise-async</span>
<span class="no">Devise</span><span class="o">::</span><span class="no">Async</span><span class="p">.</span><span class="nf">backend</span> <span class="o">=</span> <span class="ss">:resque</span>
<span class="no">Devise</span><span class="o">::</span><span class="no">Async</span><span class="p">.</span><span class="nf">backend</span> <span class="o">=</span> <span class="ss">:sidekiq</span>
</code></pre></div></div> <p>In order to get everything working propely with your gems only slight adjustments are required.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Gemfile</span>

<span class="c1">#gem 'resque', :require =&gt; "resque/server"</span>
<span class="n">gem</span> <span class="s1">'sidekiq'</span><span class="p">,</span> <span class="ss">:github</span> <span class="o">=&gt;</span> <span class="s1">'mperham/sidekiq'</span>
<span class="n">gem</span> <span class="s1">'devise-async'</span>
<span class="n">gem</span> <span class="s1">'carrierwave_backgrounder'</span>

<span class="c1"># And if your using it for caching, sessions, etc.</span>
<span class="n">gem</span> <span class="s1">'redis-rails'</span>
</code></pre></div></div> <h3 id="performance">Performance</h3> <p>Performance wise, I have have noticed a significant increase in processing speed. Resque and delayed_job were produced when Ruby/Rails was hitting a massive explosion of growth something was needed and needed fast. Don’t get me wrong Resque is an amazing ruby gem, but if your application is using thread-safe libraries Sidekiq will kick quite a punch when it comes to your background processes. Upon benchmarking, Sidekiq tends to significantly outperform Resque when it comes to completing background processes.</p> <h3 id="goworker">GoWorker</h3> <p>Seeing as how lately I’ve been dealing with <a href="http://golang.org/">Go</a> not only for it smooth edge, but compiled libraries tent to perform significantly faster than interpreted languages, another option I considered (and still am looking into is) <a href="http://www.goworker.org/">goworker</a>. Goworker is pretty much a drop in replacement for Resque and Sidekiq, relies on Redis as well and massively out performed them both. But before I attempt to push this any faster and milk every drop of performance out of the application, I plan to learn quite a bit more about programming with Go.</p> </div> <div class="ads"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-0584655001678892",enable_page_level_ads:!0});</script> </div> </div> </div> </div> </div> <script>!function(e,a,n,t,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(n),s=a.getElementsByTagName(n)[0],o.async=1,o.src=t,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-41384218-1","theworkaround.com"),ga("send","pageview");</script> </body> </html>