<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>MikroTik - Mobile Rate-Limiting | TheWorkAround</title> <meta name="generator" content="Jekyll v3.8.5"/> <meta property="og:title" content="MikroTik - Mobile Rate-Limiting"/> <meta name="author" content="Brandon Hicks"/> <meta property="og:locale" content="en_US"/> <meta name="description" content="The infinate rambelings and ideas of Brandon Hicks"/> <meta property="og:description" content="The infinate rambelings and ideas of Brandon Hicks"/> <link rel="canonical" href="http://theworkaround.com/2018/05/05/mikrotik-mobile-rate-limiting.html"/> <meta property="og:url" content="http://theworkaround.com/2018/05/05/mikrotik-mobile-rate-limiting.html"/> <meta property="og:site_name" content="TheWorkAround"/> <meta property="og:type" content="article"/> <meta property="article:published_time" content="2018-05-05T00:00:00-06:00"/> <script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"http://theworkaround.com/2018/05/05/mikrotik-mobile-rate-limiting.html"},"url":"http://theworkaround.com/2018/05/05/mikrotik-mobile-rate-limiting.html","headline":"MikroTik - Mobile Rate-Limiting","dateModified":"2018-05-05T00:00:00-06:00","datePublished":"2018-05-05T00:00:00-06:00","description":"The infinate rambelings and ideas of Brandon Hicks","author":{"@type":"Person","name":"Brandon Hicks"},"@type":"BlogPosting","@context":"https://schema.org"}</script> <meta name="title" content="MikroTik - Mobile Rate-Limiting | TheWorkAround"> <meta name="keywords" content="mikrotik,networking,routers"> <meta name="google" content="notranslate"> <meta name="robots" content="index, follow"> <meta http-equiv="Content-Language" content="en"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <link rel="preconnect" href="https://fonts.googleapis.com/" crossorigin> <link rel="preconnect" href="https://www.google-analytics.com/" crossorigin> <link rel="preconnect" href="https://ajax.googleapis.com/" crossorigin> <link rel="preconnect" href="https://cdnjs.cloudflare.com/" crossorigin> <link rel="dns-prefetch" href="https://fonts.googleapis.com/"> <link rel="dns-prefetch" href="https://www.google-analytics.com/"> <link rel="dns-prefetch" href="https://ajax.googleapis.com/"> <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com/"> <meta name="theme-color" content="#4cb8c4"> <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous"> <link rel="stylesheet" href="/assets/stylesheets/app-a09f5d095871465ede6b58bcd69c865d37a9decae5f0de1f17b636e1913e8966.css" integrity="sha256-oJ9dCVhxRl7ea1i81pyGXTep3srl8N4fF7Y24ZE+iWY=" crossorigin="anonymous"> <!--[if lt IE 9]><script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script> <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]--> <!--[if lte IE 8]><script src="https://cdnjs.cloudflare.com/ajax/libs/ie8/0.8.0/ie8.js"></script><![endif]--> <link href="/atom.xml" rel="alternate" title="Atom" type="application/atom+xml"> <link href="/rss.xml" rel="alternate" title="RSS" type="application/rss+xml"> <link href="/sitemap.xml" rel="sitemap" title="Sitemap" type="application/xml"> <link href="/humans.txt" rel="author" type="text/plain"> </head> <body> <div class="container-fluid"> <div class="site"> <div class="row"> <div class="col-md-2"> <div class="social-icons d-flex justify-content-around justify-content-md-end"> <a href="/" title="Return to Homepage" class="mx-2">/</a> <a href="http://twitter.com/tarellel" title="Follow me on Twitter" class="mx-2" rel="me"> <em class="fab fa-twitter"></em> </a> <a href="http://github.com/tarellel" title="View my code on GitHub" class="mx-2" rel="me"> <em class="fab fa-github"></em> </a> <a href="mailto:&#116;&#097;&#114;&#101;&#108;&#108;&#101;&#108;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;" title="Email Me" class="mx-2" rel="email"> <em class="fa fa-envelope"></em> </a> </div> <div class="text-right navlinks d-flex justify-content-around flex-md-column p-0 my-2"> <a href="/about" class="nav-items my-sm-3 my-md-0">About</a> <a href="/archive" class="nav-items my-sm-3 my-md-0">Archive</a> </div> </div> <div class="col-md-10 px-3"> <h1 class="post-title">MikroTik - Mobile Rate-Limiting</h1> <div class="row"> <div class="d-flex align-self-center w-100 px-3 py-0 mb-xs-3"> <p class="meta w-50 my-1">May 05, 2018</p> <div class="w-50 text-right"> Tags: <a href="/tag/mikrotik/" rel="tag">mikrotik</a>, <a href="/tag/networking/" rel="tag">networking</a>, <a href="/tag/routers/" rel="tag">routers</a> </div> </div> </div> <div class="post"> <p><img src="/img/posts/mikrotik.png" alt="" class="img-fluid w-25"/></p> <h3 id="a-brief-intro">A Brief Intro</h3> <p>I’ve been using Mikrotik routers for about a year now and I’ve had nothing but an amazing experience thus far. I haven’t taken any of the <a href="https://mikrotik.com/training/">certification</a> training courses (MTCNA, MTCRE, MTCWE) for the Mikrotik routers and thus far all my learning has been hands more of a hands on experience and following the RouterOS <a href="https://wiki.mikrotik.com/wiki/Manual:TOC">documentation</a>.</p> <p>The main reason I got into was Mikrotik routers, was when I started at my current position a little over a year go I was expected to “make some magic happen”. You see I work a nonprofit that occupies several buildings all interconnected, with the internet piped through a fiber line. I knew there was issues after my first couple of days, because they were using a consumer grade NetGear (<a href="https://www.netgear.com/landings/ad7200/">NightHawk x10</a>) router to try and support everything. There’s generally anywhere between 30-70 people in the building at any time; and considering everyone has a laptop or 2, a VoIP Phone, a cellphone, some have PC’s, and some people even have various smart devices connected as well. This was by far, way to many devices for the basic hone grade router to manage. And the network congestion was terrible; calls were always dropping, active IP addresses were being reassigned, your Upload and Download rates were absolutely terrible.</p> <p>I has never seen anything like it and I was definitely out of my scope of knowledge. I’m a web developer, not a networking administrator. But this issue with working at a nonprofit if options are limited and as the IT guy I’m expected to solve a large amount of issues at any given time. To help resolve this issue I contacted an acquaintance of mine manages the networking infrastructure of a chain of convenience stores, rest stores, and office buildings within the area.</p> <p>He recommended I use MikroTik routers because their cheap, highly efficient, easy to learn, and you don’t have to pay any crazy licensing fees. So my first introduction to the router was jumping straight into using out of the <a href="https://mikrotik.com/product/CCR1016-12G">CCR1016-12G</a> Cloud-Core Router. And I’ve have had nothing but excellent results with it, thus far.</p> <hr/> <h3 id="now-to-the-issue">Now To the Issue</h3> <p>Across the facility here are is a large number of devices assigned static IP addresses; ie. printers, VoIP phones, and several special purpose devices. Now we always have people coming from all over for meetings, training, consultation, etc. So in any one day you may have a few hundred devices connect to the network. And having a huge wireless network with a plethora of devices always connecting to the network can be a nightmare. To ensure a quality network experience, I reduced DHCP lifespans to 10 minutes this removes devices from the DHCP table after a short amount of time. I also setup a rollover subnet, so when the basic subnet chain was full it starts assigning IP addresses to a secondary subnet. I also have a default rate-limit (Queues) for when a new device connects to the network.</p> <p>Now one of the biggest issues we have is people using a ton of bandwidth on social media. Part of the problem is; we have several people who do marketing, advertising, and outreach across various social media mediums including but not limited to facebook, twitter, youtube, and few others. But we all known, people like to stream videos, baseball games, concerts, and tons of high bandwidth streams with their phones when visiting these sites.</p> <p>To counter this, I decided it’d be a good idea to specifically rate-limit/set Queue speeds for mobile devices. This isn’t a fool proof method, but it does tend to catch about 99% of all mobile devices that connect to the network. It compares the devices $hostname to a regular expression list of mobile device manufacturers. To setup up the regular expression you goto: IP&gt;Firewall&gt; [Tab] layer7 Protocols, you’ll than create a new Firewall L7 protocol and label it <code class="highlighter-rouge">mobileDevices</code> with the following regex.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">^</span><span class="p">.</span><span class="o">*</span><span class="p">(</span><span class="nx">android</span><span class="o">|</span><span class="nx">ANDROID</span><span class="o">|</span><span class="nx">AppleWatch</span><span class="o">|</span><span class="nx">BLACKBERRY</span><span class="o">|</span><span class="nx">Galaxy</span><span class="o">|</span><span class="nx">HTC</span><span class="o">|</span><span class="nx">Huaweu</span><span class="o">|</span><span class="nx">iPhone</span><span class="o">|</span><span class="nx">iPhne</span><span class="o">|</span><span class="nx">Moto</span><span class="o">|</span><span class="nx">SAMSUNG</span><span class="o">|</span><span class="nx">Xperia</span><span class="p">).</span><span class="o">*</span><span class="nx">$</span>
</code></pre></div></div> <p>You’ll now create a scheduler by going to System&gt;Scheduler and clicking the blue plus button. I went conservatively assigned it to loop through every 5 minutes, if you’re in a pretty busy office I’d say you may even want to do 2 minute intervals. I’d also say part of this script is unnecessary, but I decided to reassign the queue limits to non mobile devices just for secondary measures. And the second loop in the script is because I have various VIP devices that need higher bandwidth limits than the rest of the network. So they are specifically assigned static IP address with their queue limits. Like I said, about half this script isn’t necessary, but I implemented it in just to take precautions.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">/</span><span class="nx">queue</span> <span class="nx">simple</span> <span class="nx">remove</span> <span class="p">[</span><span class="sr">/queue simple find</span><span class="err">]
</span><span class="p">:</span><span class="nb">global</span> <span class="nx">layer7</span> <span class="p">[</span><span class="sr">/ ip firewall layer7-protocol find name="mobileDevices"</span><span class="err">]
</span><span class="p">:</span><span class="nb">global</span> <span class="nx">mobileDevices</span> <span class="p">[</span><span class="sr">/ ip firewall layer7-protocol get $layer7 regexp</span><span class="err">]
</span><span class="p">:</span><span class="nb">global</span> <span class="nx">mobileLimit</span> <span class="s2">"1024k/1024k"</span>
<span class="p">:</span><span class="nb">global</span> <span class="nx">pcLimit</span> <span class="s2">"3M/5M"</span>
<span class="c1">// if the specified device's IP address is being assigned with DHCP</span>
<span class="p">:</span><span class="nx">foreach</span> <span class="nx">i</span> <span class="k">in</span><span class="o">=</span><span class="p">[</span><span class="sr">/ip dhcp-server lease find dynamic=yes] do=</span><span class="err">{
</span>  <span class="p">:</span><span class="nx">local</span> <span class="nx">ipAddr</span> <span class="p">[</span><span class="sr">/ip dhcp-server lease get $i address]</span><span class="err">;
</span>  <span class="p">:</span><span class="nx">local</span> <span class="nx">hostname</span> <span class="p">[</span><span class="sr">/ip dhcp-server lease get $i host-name]</span><span class="err">;
</span>  <span class="p">:</span><span class="nx">local</span> <span class="nx">macAddress</span> <span class="p">[</span><span class="sr">/ip dhcp-server lease get $i mac-address</span><span class="err">]
</span>  <span class="p">:</span><span class="nx">local</span> <span class="nx">queueName</span> <span class="s2">"Client - $macAddress"</span>

  <span class="p">:</span><span class="k">if</span> <span class="p">(</span><span class="nx">$hostname</span> <span class="o">~</span> <span class="nx">$mobileDevices</span><span class="o">=</span> <span class="kc">true</span><span class="p">)</span> <span class="k">do</span><span class="o">=</span><span class="p">{</span>
    <span class="c1">// if the device has been found to be a mobile device, reduce it's bandwidth - $mobileLimit</span>
    <span class="o">/</span><span class="nx">queue</span> <span class="nx">simple</span> <span class="nx">add</span> <span class="nx">name</span><span class="o">=</span><span class="s2">"$queueName"</span> <span class="nx">comment</span><span class="o">=</span><span class="s2">"$hostname"</span> <span class="nx">target</span><span class="o">=</span><span class="s2">"$ipAddr"</span> <span class="nx">max</span><span class="o">-</span><span class="nx">limit</span><span class="o">=</span><span class="s2">"$mobileLimit"</span>
  <span class="p">}</span> <span class="k">else</span><span class="o">=</span><span class="p">{</span>
    <span class="c1">// otherwise set the devices bandwidth limits to the default bandwidth limits - $pcLimit</span>
    <span class="o">/</span><span class="nx">queue</span> <span class="nx">simple</span> <span class="nx">add</span> <span class="nx">name</span><span class="o">=</span><span class="s2">"$queueName"</span> <span class="nx">comment</span><span class="o">=</span><span class="s2">"$hostname"</span> <span class="nx">target</span><span class="o">=</span><span class="s2">"$ipAddr"</span> <span class="nx">max</span><span class="o">-</span><span class="nx">limit</span><span class="o">=</span><span class="s2">"$pcLimit"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// If device is connected with a static IP address or not using DHCP to assign it's IP</span>
<span class="p">:</span><span class="nx">foreach</span> <span class="nx">i</span> <span class="k">in</span><span class="o">=</span><span class="p">[</span><span class="sr">/ip dhcp-server lease find dynamic=no] do=</span><span class="err">{
</span>  <span class="p">:</span><span class="nx">local</span> <span class="nx">ipAddr</span> <span class="p">[</span><span class="sr">/ip dhcp-server lease get $i address]</span><span class="err">;
</span>  <span class="p">:</span><span class="nx">local</span> <span class="nx">hostname</span> <span class="p">[</span><span class="sr">/ip dhcp-server lease get $i host-name]</span><span class="err">;
</span>  <span class="p">:</span><span class="nx">local</span> <span class="nx">macAddress</span> <span class="p">[</span><span class="sr">/ip dhcp-server lease get $i mac-address</span><span class="err">]
</span>  <span class="p">:</span><span class="nx">local</span> <span class="nx">queueName</span> <span class="s2">"Client - $macAddress"</span>
  <span class="p">:</span><span class="nx">local</span> <span class="nx">vipLimit</span> <span class="s2">"10M/10M"</span>

  <span class="c1">// hostnames for VIP devices in which to have a high bandwidth limit - $vipLimit</span>
  <span class="p">:</span><span class="k">if</span> <span class="p">(</span><span class="nx">$hostname</span> <span class="o">=</span> <span class="s2">"VIPdesktops"</span> <span class="o">||</span> <span class="nx">$hostname</span> <span class="o">=</span> <span class="s2">"VIPlaptops"</span> <span class="o">||</span> <span class="nx">$hostname</span> <span class="o">=</span> <span class="s2">"VIPdevice"</span><span class="p">)</span> <span class="k">do</span><span class="o">=</span><span class="p">{</span>
    <span class="o">/</span><span class="nx">queue</span> <span class="nx">simple</span> <span class="nx">add</span> <span class="nx">name</span><span class="o">=</span><span class="s2">"$queueName"</span> <span class="nx">comment</span><span class="o">=</span><span class="s2">"$hostname"</span> <span class="nx">target</span><span class="o">=</span><span class="s2">"$ipAddr"</span> <span class="nx">max</span><span class="o">-</span><span class="nx">limit</span><span class="o">=</span><span class="s2">"$vipLimit"</span>
  <span class="p">}</span> <span class="k">else</span><span class="o">=</span><span class="p">{</span>
    <span class="c1">// otherwise set the devices bandwidth limits to the default bandwidth limits - $pcLimit</span>
    <span class="o">/</span><span class="nx">queue</span> <span class="nx">simple</span> <span class="nx">add</span> <span class="nx">name</span><span class="o">=</span><span class="s2">"$queueName"</span> <span class="nx">comment</span><span class="o">=</span><span class="s2">"$hostname"</span> <span class="nx">target</span><span class="o">=</span><span class="s2">"$ipAddr"</span> <span class="nx">max</span><span class="o">-</span><span class="nx">limit</span><span class="o">=</span><span class="s2">"$pcLimit"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>This isn’t a fool proof method, but it does catch the vast majority of mobile devices. This is because by default their devices are labeled with their specific manufacturer as part of the device name. And for the most rarely does anyone ever rename their devices hostname. While watching the network traffic, I can say I’ve only saw a handful of mobile devices that haven’t been labeled with either Samsung, Iphone, or Galaxy.</p> <p>~ <strong>Note:</strong> This may not be the best or the most effective script for what I wanted to achieve, but it accomplished what I needed to do. And it’s been tested and proven to work effectively for exactly what I needed.</p> <h5 id="updated-53118">UPDATED: <small class="text-muted">5/31/18</small></h5> <p>After updating our Routers’ packages and routerboad to v6.42.3, I begun having issues with the script showing above. So I removed the Layer7 and revamped the script to use it hostname matches through a variable string. The new revision appears to run a bit faster than the previous version and in my opinion, it seems to be a bit easier to read.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">/</span><span class="nx">queue</span> <span class="nx">simple</span> <span class="nx">remove</span> <span class="p">[</span><span class="sr">/queue simple find</span><span class="err">]
</span><span class="p">:</span><span class="nb">global</span> <span class="nx">mobileDevices</span> <span class="s2">"android|ANDROID|AppleWatch|BLACKBERRY|Galaxy|HTC|Huawei|iPad|iPhone|iphone|iPhne|Moto|SAMSUNG|Unknown|Xperia"</span>
<span class="p">:</span><span class="nb">global</span> <span class="nx">mobileLimit</span> <span class="s2">"1024k/1024k"</span>
<span class="p">:</span><span class="nb">global</span> <span class="nx">pcLimit</span> <span class="s2">"2M/5M"</span>

<span class="p">:</span><span class="nb">global</span> <span class="nx">vipDevices</span> <span class="s2">"VIPdesktops|VIPlaptops|VIPdevice|VIPservers|MikroTik|CapAC"</span>
<span class="p">:</span><span class="nb">global</span> <span class="nx">vipLimit</span> <span class="s2">"10M/10M"</span>

<span class="o">/</span><span class="nx">ip</span> <span class="nx">dhcp</span><span class="o">-</span><span class="nx">server</span> <span class="nx">lease</span> <span class="p">{</span>
  <span class="p">:</span><span class="nx">foreach</span> <span class="nx">i</span> <span class="k">in</span><span class="o">=</span><span class="p">[</span><span class="nx">find</span> <span class="p">(</span><span class="nx">dynamic</span> <span class="o">&amp;&amp;</span> <span class="nx">status</span><span class="o">=</span><span class="s2">"bound"</span><span class="p">)]</span> <span class="k">do</span><span class="o">=</span><span class="p">{</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">activeAddress</span> <span class="p">[</span><span class="kd">get</span> <span class="nx">$i</span> <span class="nx">active</span><span class="o">-</span><span class="nx">address</span><span class="p">]</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">activeMacAddress</span> <span class="p">[</span><span class="kd">get</span> <span class="nx">$i</span> <span class="nx">active</span><span class="o">-</span><span class="nx">mac</span><span class="o">-</span><span class="nx">address</span><span class="p">]</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">macAddress</span> <span class="p">[</span><span class="kd">get</span> <span class="nx">$i</span> <span class="nx">mac</span><span class="o">-</span><span class="nx">address</span><span class="p">]</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">hostname</span> <span class="p">[</span><span class="kd">get</span> <span class="nx">$i</span> <span class="nx">host</span><span class="o">-</span><span class="nx">name</span><span class="p">]</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">ipAddr</span> <span class="p">[</span><span class="kd">get</span> <span class="nx">$i</span> <span class="nx">address</span><span class="p">]</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">queueName</span> <span class="s2">"Client - $macAddress"</span>

    <span class="p">:</span><span class="k">if</span> <span class="p">(</span><span class="nx">$hostname</span> <span class="o">~</span> <span class="nx">$mobileDevices</span><span class="o">=</span> <span class="kc">true</span><span class="p">)</span> <span class="k">do</span><span class="o">=</span><span class="p">{</span>
      <span class="o">/</span><span class="nx">queue</span> <span class="nx">simple</span> <span class="nx">add</span> <span class="nx">name</span><span class="o">=</span><span class="s2">"$queueName"</span> <span class="nx">comment</span><span class="o">=</span><span class="s2">"$hostname"</span> <span class="nx">target</span><span class="o">=</span><span class="s2">"$ipAddr"</span> <span class="nx">max</span><span class="o">-</span><span class="nx">limit</span><span class="o">=</span><span class="s2">"$mobileLimit"</span>
    <span class="p">}</span> <span class="k">else</span><span class="o">=</span><span class="p">{</span>
      <span class="o">/</span><span class="nx">queue</span> <span class="nx">simple</span> <span class="nx">add</span> <span class="nx">name</span><span class="o">=</span><span class="s2">"$queueName"</span> <span class="nx">comment</span><span class="o">=</span><span class="s2">"$hostname"</span> <span class="nx">target</span><span class="o">=</span><span class="s2">"$ipAddr"</span> <span class="nx">max</span><span class="o">-</span><span class="nx">limit</span><span class="o">=</span><span class="s2">"$pcLimit"</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="p">:</span><span class="nx">foreach</span> <span class="nx">i</span> <span class="k">in</span><span class="o">=</span><span class="p">[</span><span class="nx">find</span> <span class="p">(</span><span class="o">!</span><span class="nx">dynamic</span> <span class="o">&amp;&amp;</span> <span class="nx">status</span><span class="o">=</span><span class="s2">"bound"</span><span class="p">)]</span> <span class="k">do</span><span class="o">=</span><span class="p">{</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">activeAddress</span> <span class="p">[</span><span class="kd">get</span> <span class="nx">$i</span> <span class="nx">active</span><span class="o">-</span><span class="nx">address</span><span class="p">]</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">activeMacAddress</span> <span class="p">[</span><span class="kd">get</span> <span class="nx">$i</span> <span class="nx">active</span><span class="o">-</span><span class="nx">mac</span><span class="o">-</span><span class="nx">address</span><span class="p">]</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">macAddress</span> <span class="p">[</span><span class="kd">get</span> <span class="nx">$i</span> <span class="nx">mac</span><span class="o">-</span><span class="nx">address</span><span class="p">]</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">hostname</span> <span class="p">[</span><span class="kd">get</span> <span class="nx">$i</span> <span class="nx">host</span><span class="o">-</span><span class="nx">name</span><span class="p">]</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">ipAddr</span> <span class="p">[</span><span class="kd">get</span> <span class="nx">$i</span> <span class="nx">address</span><span class="p">]</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">queueName</span> <span class="s2">"Client - $macAddress"</span>

   <span class="p">:</span><span class="k">if</span> <span class="p">(</span><span class="nx">$hostname</span> <span class="o">~</span> <span class="nx">$vipDevices</span><span class="o">=</span> <span class="kc">true</span><span class="p">)</span> <span class="k">do</span><span class="o">=</span><span class="p">{</span>
     <span class="o">/</span><span class="nx">queue</span> <span class="nx">simple</span> <span class="nx">add</span> <span class="nx">name</span><span class="o">=</span><span class="s2">"$queueName"</span> <span class="nx">comment</span><span class="o">=</span><span class="s2">"$hostname"</span> <span class="nx">target</span><span class="o">=</span><span class="s2">"$ipAddr"</span> <span class="nx">max</span><span class="o">-</span><span class="nx">limit</span><span class="o">=</span><span class="s2">"$vipLimit"</span>
   <span class="p">}</span> <span class="k">else</span><span class="o">=</span><span class="p">{</span>
     <span class="o">/</span><span class="nx">queue</span> <span class="nx">simple</span> <span class="nx">add</span> <span class="nx">name</span><span class="o">=</span><span class="s2">"$queueName"</span> <span class="nx">comment</span><span class="o">=</span><span class="s2">"$hostname"</span> <span class="nx">target</span><span class="o">=</span><span class="s2">"$ipAddr"</span> <span class="nx">max</span><span class="o">-</span><span class="nx">limit</span><span class="o">=</span><span class="s2">"$pcLimit"</span>
   <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> </div> <div class="ads"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-0584655001678892",enable_page_level_ads:!0});</script> </div> <div id="disqus_thread"></div> <script>!function(){var e=document,t=e.createElement("script");t.src="//theworkaround.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> </div> </div> </div> </div> <script>!function(e,a,n,t,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(n),s=a.getElementsByTagName(n)[0],o.async=1,o.src=t,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-41384218-1","theworkaround.com"),ga("send","pageview");</script> </body> </html>