<!doctype html> <html lang="en"> <head> <meta charset="utf-8"/> <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta http-equiv="Content-Language" content="en"> <title>MikroTik - Mobile Rate-Limiting | TheWorkAround</title> <meta property="og:title" content="MikroTik - Mobile Rate-Limiting"/> <meta name="author" content="Brandon"/> <meta property="og:locale" content="en_US"/> <meta name="description" content="The infinite ramblings and ideas of Brandon Hicks"/> <meta property="og:description" content="The infinite ramblings and ideas of Brandon Hicks"/> <link rel="canonical" href="https://theworkaround.com/2018/05/05/mikrotik-mobile-rate-limiting/"/> <meta property="og:url" content="https://theworkaround.com/2018/05/05/mikrotik-mobile-rate-limiting/"/> <meta property="og:site_name" content="TheWorkAround"/> <meta property="og:type" content="article"/> <meta property="article:published_time" content="2018-05-05T00:00:00+00:00"/> <meta name="twitter:card" content="summary"/> <meta property="twitter:title" content="MikroTik - Mobile Rate-Limiting"/> <link type="application/atom+xml" rel="alternate" href="https://theworkaround.com/feed.xml" title="TheWorkAround"/> <meta name="author" content="Brandon Hicks"> <meta name="description" content="The infinite ramblings and ideas of Brandon Hicks"/> <meta name="generator" content="Bridgetown"> <meta name="referrer" content="no-referrer-when-downgrade"> <meta name="robots" content="index, follow"> <link rel="preload" href="/_bridgetown/static/index.O7LCYKF7.css" as="style"> <link rel="preload" href="/_bridgetown/static/index.IGRG3H33.js" as="script"> <link rel="preconnect" href="/" crossorigin> <link rel="preconnect" href="https://rsms.me/inter/inter.css" crossorigin> <link rel="dns-prefetch" href="https://www.googletagmanager.com/"> <link rel="dns-prefetch" href="https://www.google-analytics.com/"> <link rel="dns-prefetch" href="https://ajax.googleapis.com/"> <link rel="stylesheet" href="https://rsms.me/inter/inter.css"> <link rel="stylesheet" href="/_bridgetown/static/index.O7LCYKF7.css" data-turbo-track="reload"/> <script src="/_bridgetown/static/index.IGRG3H33.js" data-turbo-track="reload" defer></script> <link href="https://theworkaround.com/sitemap.xml" rel="sitemap" title="Sitemap" type="application/xml"> <link href="https://theworkaround.com/humans.txt" rel="author" type="text/plain"> <link rel="manifest" href="https://theworkaround.com/site.webmanifest"> <link rel="me" href="https://theworkaround.com/" type="text/html"> <link rel="me" href="https://github.com/tarellel"> <link rel="me" href="https://twitter.com/tarellel"> <meta name="theme-color" content="#4cb8c4"> </head> <body class="post antialiased min-h-full font-inter font-normal leading-normal bg-white text-gray-400"> <nav class="border-t-12 border-cyan-600 py-3 flex flex-col sm:flex-row sm:justify-between sm:items-center p-4" role="navigation" aria-label="Main"> <div class="text-left"> <h3 class="text-3xl font-extrabold text-gray-600"> <a href="/" class="text-gray-600" title="Goto /" key="home">TheWorkAround</a> </h3> <p class="text-md font-semibold leading-5 text-gray-400">Brandon Hicks</p> </div> <div class="sm:text-right text-lg lg:text-xl flex space-y-4 sm:space-y-0 sm:space-x-9 content-center mt-3 sm:mt-0 flex-col sm:flex-row"> <a href="https://theworkaround.com/about" class="font-semibold text-gray-700 tracking-tight" title="About Me" key="about">About</a> <a href="https://theworkaround.com/posts" class="font-semibold text-gray-700 tracking-tight" title="View a list of all posts" key="posts">Posts</a> <a href="https://theworkaround.com/projects"" class="font-semibold text-gray-700 tracking-tight" title="Projects I'm working on" key="projects">Projects</a> <a href="https://theworkaround.com/feed.xml" class="flex content-center text-orange-600" title="RSS Feed" key="feed"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" className="h-5 w-5 self-center text-orange-600" class=" h-5 w-5 self-center text-orange-600" alt="RSS Feed Icon" aria-hidden="true" focusable="false" role="img"> <path d="M4 11a9 9 0 0 1 9 9"></path> <path d="M4 4a16 16 0 0 1 16 16"></path> <circle cx="5" cy="19" r="1"></circle> </svg> </a> </div> </nav> <main class="post px-10 sm:px-7 border-0"> <h1>MikroTik - Mobile Rate-Limiting</h1> <p><img src="/images/posts/mikrotik.png" alt="" class="img-fluid w-3/12"/></p> <h3 id="a-brief-intro">A Brief Intro</h3> <p>I’ve been using Mikrotik routers for about a year now and I’ve had nothing but an amazing experience thus far. I haven’t taken any of the <a href="https://mikrotik.com/training/">certification</a> training courses (MTCNA, MTCRE, MTCWE) for the Mikrotik routers and thus far all my learning has been hands more of a hands on experience and following the RouterOS <a href="https://wiki.mikrotik.com/wiki/Manual:TOC">documentation</a>.</p> <p>The main reason I got into was Mikrotik routers, was when I started at my current position a little over a year go I was expected to “make some magic happen”. You see I work a nonprofit that occupies several buildings all interconnected, with the internet piped through a fiber line. I knew there was issues after my first couple of days, because they were using a consumer grade NetGear (<a href="https://www.netgear.com/landings/ad7200/">NightHawk x10</a>) router to try and support everything. There’s generally anywhere between 30-70 people in the building at any time; and considering everyone has a laptop or 2, a VoIP Phone, a cellphone, some have PC’s, and some people even have various smart devices connected as well. This was by far, way to many devices for the basic hone grade router to manage. And the network congestion was terrible; calls were always dropping, active IP addresses were being reassigned, your Upload and Download rates were absolutely terrible.</p> <p>I has never seen anything like it and I was definitely out of my scope of knowledge. I’m a web developer, not a networking administrator. But this issue with working at a nonprofit if options are limited and as the IT guy I’m expected to solve a large amount of issues at any given time. To help resolve this issue I contacted an acquaintance of mine manages the networking infrastructure of a chain of convenience stores, rest stores, and office buildings within the area.</p> <p>He recommended I use MikroTik routers because their cheap, highly efficient, easy to learn, and you don’t have to pay any crazy licensing fees. So my first introduction to the router was jumping straight into using out of the <a href="https://mikrotik.com/product/CCR1016-12G">CCR1016-12G</a> Cloud-Core Router. And I’ve have had nothing but excellent results with it, thus far.</p> <hr/> <h3 id="now-to-the-issue">Now To the Issue</h3> <p>Across the facility here are is a large number of devices assigned static IP addresses; ie. printers, VoIP phones, and several special purpose devices. Now we always have people coming from all over for meetings, training, consultation, etc. So in any one day you may have a few hundred devices connect to the network. And having a huge wireless network with a plethora of devices always connecting to the network can be a nightmare. To ensure a quality network experience, I reduced DHCP lifespans to 10 minutes this removes devices from the DHCP table after a short amount of time. I also setup a rollover subnet, so when the basic subnet chain was full it starts assigning IP addresses to a secondary subnet. I also have a default rate-limit (Queues) for when a new device connects to the network.</p> <p>Now one of the biggest issues we have is people using a ton of bandwidth on social media. Part of the problem is; we have several people who do marketing, advertising, and outreach across various social media mediums including but not limited to facebook, twitter, youtube, and few others. But we all known, people like to stream videos, baseball games, concerts, and tons of high bandwidth streams with their phones when visiting these sites.</p> <p>To counter this, I decided it’d be a good idea to specifically rate-limit/set Queue speeds for mobile devices. This isn’t a fool proof method, but it does tend to catch about 99% of all mobile devices that connect to the network. It compares the devices $hostname to a regular expression list of mobile device manufacturers. To setup up the regular expression you goto: IP&gt;Firewall&gt; [Tab] layer7 Protocols, you’ll than create a new Firewall L7 protocol and label it <code class="highlighter-rouge">mobileDevices</code> with the following regex.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">^</span><span class="p">.</span><span class="o">*</span><span class="p">(</span><span class="nx">android</span><span class="o">|</span><span class="nx">ANDROID</span><span class="o">|</span><span class="nx">AppleWatch</span><span class="o">|</span><span class="nx">BLACKBERRY</span><span class="o">|</span><span class="nx">Galaxy</span><span class="o">|</span><span class="nx">HTC</span><span class="o">|</span><span class="nx">Huaweu</span><span class="o">|</span><span class="nx">iPhone</span><span class="o">|</span><span class="nx">iPhne</span><span class="o">|</span><span class="nx">Moto</span><span class="o">|</span><span class="nx">SAMSUNG</span><span class="o">|</span><span class="nx">Xperia</span><span class="p">).</span><span class="o">*</span><span class="nx">$</span>
</code></pre></div></div> <p>You’ll now create a scheduler by going to System&gt;Scheduler and clicking the blue plus button. I went conservatively assigned it to loop through every 5 minutes, if you’re in a pretty busy office I’d say you may even want to do 2 minute intervals. I’d also say part of this script is unnecessary, but I decided to reassign the queue limits to non mobile devices just for secondary measures. And the second loop in the script is because I have various VIP devices that need higher bandwidth limits than the rest of the network. So they are specifically assigned static IP address with their queue limits. Like I said, about half this script isn’t necessary, but I implemented it in just to take precautions.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">/</span><span class="nx">queue</span> <span class="nx">simple</span> <span class="nx">remove</span> <span class="p">[</span><span class="sr">/queue simple find</span><span class="err">]
</span><span class="p">:</span><span class="nb">global</span> <span class="nx">layer7</span> <span class="p">[</span><span class="sr">/ ip firewall layer7-protocol find name="mobileDevices"</span><span class="err">]
</span><span class="p">:</span><span class="nb">global</span> <span class="nx">mobileDevices</span> <span class="p">[</span><span class="sr">/ ip firewall layer7-protocol get $layer7 regexp</span><span class="err">]
</span><span class="p">:</span><span class="nb">global</span> <span class="nx">mobileLimit</span> <span class="dl">"</span><span class="s2">1024k/1024k</span><span class="dl">"</span>
<span class="p">:</span><span class="nb">global</span> <span class="nx">pcLimit</span> <span class="dl">"</span><span class="s2">3M/5M</span><span class="dl">"</span>
<span class="c1">// if the specified device's IP address is being assigned with DHCP</span>
<span class="p">:</span><span class="nx">foreach</span> <span class="nx">i</span> <span class="k">in</span><span class="o">=</span><span class="p">[</span><span class="sr">/ip dhcp-server lease find dynamic=yes] do=</span><span class="err">{
</span>  <span class="p">:</span><span class="nx">local</span> <span class="nx">ipAddr</span> <span class="p">[</span><span class="sr">/ip dhcp-server lease get $i address]</span><span class="err">;
</span>  <span class="p">:</span><span class="nx">local</span> <span class="nx">hostname</span> <span class="p">[</span><span class="sr">/ip dhcp-server lease get $i host-name]</span><span class="err">;
</span>  <span class="p">:</span><span class="nx">local</span> <span class="nx">macAddress</span> <span class="p">[</span><span class="sr">/ip dhcp-server lease get $i mac-address</span><span class="err">]
</span>  <span class="p">:</span><span class="nx">local</span> <span class="nx">queueName</span> <span class="dl">"</span><span class="s2">Client - $macAddress</span><span class="dl">"</span>

  <span class="p">:</span><span class="k">if</span> <span class="p">(</span><span class="nx">$hostname</span> <span class="o">~</span> <span class="nx">$mobileDevices</span><span class="o">=</span> <span class="kc">true</span><span class="p">)</span> <span class="k">do</span><span class="o">=</span><span class="p">{</span>
    <span class="c1">// if the device has been found to be a mobile device, reduce it's bandwidth - $mobileLimit</span>
    <span class="o">/</span><span class="nx">queue</span> <span class="nx">simple</span> <span class="nx">add</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">$queueName</span><span class="dl">"</span> <span class="nx">comment</span><span class="o">=</span><span class="dl">"</span><span class="s2">$hostname</span><span class="dl">"</span> <span class="nx">target</span><span class="o">=</span><span class="dl">"</span><span class="s2">$ipAddr</span><span class="dl">"</span> <span class="nx">max</span><span class="o">-</span><span class="nx">limit</span><span class="o">=</span><span class="dl">"</span><span class="s2">$mobileLimit</span><span class="dl">"</span>
  <span class="p">}</span> <span class="k">else</span><span class="o">=</span><span class="p">{</span>
    <span class="c1">// otherwise set the devices bandwidth limits to the default bandwidth limits - $pcLimit</span>
    <span class="o">/</span><span class="nx">queue</span> <span class="nx">simple</span> <span class="nx">add</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">$queueName</span><span class="dl">"</span> <span class="nx">comment</span><span class="o">=</span><span class="dl">"</span><span class="s2">$hostname</span><span class="dl">"</span> <span class="nx">target</span><span class="o">=</span><span class="dl">"</span><span class="s2">$ipAddr</span><span class="dl">"</span> <span class="nx">max</span><span class="o">-</span><span class="nx">limit</span><span class="o">=</span><span class="dl">"</span><span class="s2">$pcLimit</span><span class="dl">"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// If device is connected with a static IP address or not using DHCP to assign it's IP</span>
<span class="p">:</span><span class="nx">foreach</span> <span class="nx">i</span> <span class="k">in</span><span class="o">=</span><span class="p">[</span><span class="sr">/ip dhcp-server lease find dynamic=no] do=</span><span class="err">{
</span>  <span class="p">:</span><span class="nx">local</span> <span class="nx">ipAddr</span> <span class="p">[</span><span class="sr">/ip dhcp-server lease get $i address]</span><span class="err">;
</span>  <span class="p">:</span><span class="nx">local</span> <span class="nx">hostname</span> <span class="p">[</span><span class="sr">/ip dhcp-server lease get $i host-name]</span><span class="err">;
</span>  <span class="p">:</span><span class="nx">local</span> <span class="nx">macAddress</span> <span class="p">[</span><span class="sr">/ip dhcp-server lease get $i mac-address</span><span class="err">]
</span>  <span class="p">:</span><span class="nx">local</span> <span class="nx">queueName</span> <span class="dl">"</span><span class="s2">Client - $macAddress</span><span class="dl">"</span>
  <span class="p">:</span><span class="nx">local</span> <span class="nx">vipLimit</span> <span class="dl">"</span><span class="s2">10M/10M</span><span class="dl">"</span>

  <span class="c1">// hostnames for VIP devices in which to have a high bandwidth limit - $vipLimit</span>
  <span class="p">:</span><span class="k">if</span> <span class="p">(</span><span class="nx">$hostname</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">VIPdesktops</span><span class="dl">"</span> <span class="o">||</span> <span class="nx">$hostname</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">VIPlaptops</span><span class="dl">"</span> <span class="o">||</span> <span class="nx">$hostname</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">VIPdevice</span><span class="dl">"</span><span class="p">)</span> <span class="k">do</span><span class="o">=</span><span class="p">{</span>
    <span class="o">/</span><span class="nx">queue</span> <span class="nx">simple</span> <span class="nx">add</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">$queueName</span><span class="dl">"</span> <span class="nx">comment</span><span class="o">=</span><span class="dl">"</span><span class="s2">$hostname</span><span class="dl">"</span> <span class="nx">target</span><span class="o">=</span><span class="dl">"</span><span class="s2">$ipAddr</span><span class="dl">"</span> <span class="nx">max</span><span class="o">-</span><span class="nx">limit</span><span class="o">=</span><span class="dl">"</span><span class="s2">$vipLimit</span><span class="dl">"</span>
  <span class="p">}</span> <span class="k">else</span><span class="o">=</span><span class="p">{</span>
    <span class="c1">// otherwise set the devices bandwidth limits to the default bandwidth limits - $pcLimit</span>
    <span class="o">/</span><span class="nx">queue</span> <span class="nx">simple</span> <span class="nx">add</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">$queueName</span><span class="dl">"</span> <span class="nx">comment</span><span class="o">=</span><span class="dl">"</span><span class="s2">$hostname</span><span class="dl">"</span> <span class="nx">target</span><span class="o">=</span><span class="dl">"</span><span class="s2">$ipAddr</span><span class="dl">"</span> <span class="nx">max</span><span class="o">-</span><span class="nx">limit</span><span class="o">=</span><span class="dl">"</span><span class="s2">$pcLimit</span><span class="dl">"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>This isn’t a fool proof method, but it does catch the vast majority of mobile devices. This is because by default their devices are labeled with their specific manufacturer as part of the device name. And for the most rarely does anyone ever rename their devices hostname. While watching the network traffic, I can say I’ve only saw a handful of mobile devices that haven’t been labeled with either Samsung, Iphone, or Galaxy.</p> <p>~ <strong>Note:</strong> This may not be the best or the most effective script for what I wanted to achieve, but it accomplished what I needed to do. And it’s been tested and proven to work effectively for exactly what I needed.</p> <h5 id="updated-53118">UPDATED: <small class="text-muted">5/31/18</small></h5> <p>After updating our Routers’ packages and routerboad to v6.42.3, I begun having issues with the script showing above. So I removed the Layer7 and revamped the script to use it hostname matches through a variable string. The new revision appears to run a bit faster than the previous version and in my opinion, it seems to be a bit easier to read.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">/</span><span class="nx">queue</span> <span class="nx">simple</span> <span class="nx">remove</span> <span class="p">[</span><span class="sr">/queue simple find</span><span class="err">]
</span><span class="p">:</span><span class="nb">global</span> <span class="nx">mobileDevices</span> <span class="dl">"</span><span class="s2">android|ANDROID|AppleWatch|BLACKBERRY|Galaxy|HTC|Huawei|iPad|iPhone|iphone|iPhne|Moto|SAMSUNG|Unknown|Xperia</span><span class="dl">"</span>
<span class="p">:</span><span class="nb">global</span> <span class="nx">mobileLimit</span> <span class="dl">"</span><span class="s2">1024k/1024k</span><span class="dl">"</span>
<span class="p">:</span><span class="nb">global</span> <span class="nx">pcLimit</span> <span class="dl">"</span><span class="s2">2M/5M</span><span class="dl">"</span>

<span class="p">:</span><span class="nb">global</span> <span class="nx">vipDevices</span> <span class="dl">"</span><span class="s2">VIPdesktops|VIPlaptops|VIPdevice|VIPservers|MikroTik|CapAC</span><span class="dl">"</span>
<span class="p">:</span><span class="nb">global</span> <span class="nx">vipLimit</span> <span class="dl">"</span><span class="s2">10M/10M</span><span class="dl">"</span>

<span class="o">/</span><span class="nx">ip</span> <span class="nx">dhcp</span><span class="o">-</span><span class="nx">server</span> <span class="nx">lease</span> <span class="p">{</span>
  <span class="p">:</span><span class="nx">foreach</span> <span class="nx">i</span> <span class="k">in</span><span class="o">=</span><span class="p">[</span><span class="nx">find</span> <span class="p">(</span><span class="nx">dynamic</span> <span class="o">&amp;&amp;</span> <span class="nx">status</span><span class="o">=</span><span class="dl">"</span><span class="s2">bound</span><span class="dl">"</span><span class="p">)]</span> <span class="k">do</span><span class="o">=</span><span class="p">{</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">activeAddress</span> <span class="p">[</span><span class="kd">get</span> <span class="nx">$i</span> <span class="nx">active</span><span class="o">-</span><span class="nx">address</span><span class="p">]</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">activeMacAddress</span> <span class="p">[</span><span class="kd">get</span> <span class="nx">$i</span> <span class="nx">active</span><span class="o">-</span><span class="nx">mac</span><span class="o">-</span><span class="nx">address</span><span class="p">]</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">macAddress</span> <span class="p">[</span><span class="kd">get</span> <span class="nx">$i</span> <span class="nx">mac</span><span class="o">-</span><span class="nx">address</span><span class="p">]</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">hostname</span> <span class="p">[</span><span class="kd">get</span> <span class="nx">$i</span> <span class="nx">host</span><span class="o">-</span><span class="nx">name</span><span class="p">]</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">ipAddr</span> <span class="p">[</span><span class="kd">get</span> <span class="nx">$i</span> <span class="nx">address</span><span class="p">]</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">queueName</span> <span class="dl">"</span><span class="s2">Client - $macAddress</span><span class="dl">"</span>

    <span class="p">:</span><span class="k">if</span> <span class="p">(</span><span class="nx">$hostname</span> <span class="o">~</span> <span class="nx">$mobileDevices</span><span class="o">=</span> <span class="kc">true</span><span class="p">)</span> <span class="k">do</span><span class="o">=</span><span class="p">{</span>
      <span class="o">/</span><span class="nx">queue</span> <span class="nx">simple</span> <span class="nx">add</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">$queueName</span><span class="dl">"</span> <span class="nx">comment</span><span class="o">=</span><span class="dl">"</span><span class="s2">$hostname</span><span class="dl">"</span> <span class="nx">target</span><span class="o">=</span><span class="dl">"</span><span class="s2">$ipAddr</span><span class="dl">"</span> <span class="nx">max</span><span class="o">-</span><span class="nx">limit</span><span class="o">=</span><span class="dl">"</span><span class="s2">$mobileLimit</span><span class="dl">"</span>
    <span class="p">}</span> <span class="k">else</span><span class="o">=</span><span class="p">{</span>
      <span class="o">/</span><span class="nx">queue</span> <span class="nx">simple</span> <span class="nx">add</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">$queueName</span><span class="dl">"</span> <span class="nx">comment</span><span class="o">=</span><span class="dl">"</span><span class="s2">$hostname</span><span class="dl">"</span> <span class="nx">target</span><span class="o">=</span><span class="dl">"</span><span class="s2">$ipAddr</span><span class="dl">"</span> <span class="nx">max</span><span class="o">-</span><span class="nx">limit</span><span class="o">=</span><span class="dl">"</span><span class="s2">$pcLimit</span><span class="dl">"</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="p">:</span><span class="nx">foreach</span> <span class="nx">i</span> <span class="k">in</span><span class="o">=</span><span class="p">[</span><span class="nx">find</span> <span class="p">(</span><span class="o">!</span><span class="nx">dynamic</span> <span class="o">&amp;&amp;</span> <span class="nx">status</span><span class="o">=</span><span class="dl">"</span><span class="s2">bound</span><span class="dl">"</span><span class="p">)]</span> <span class="k">do</span><span class="o">=</span><span class="p">{</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">activeAddress</span> <span class="p">[</span><span class="kd">get</span> <span class="nx">$i</span> <span class="nx">active</span><span class="o">-</span><span class="nx">address</span><span class="p">]</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">activeMacAddress</span> <span class="p">[</span><span class="kd">get</span> <span class="nx">$i</span> <span class="nx">active</span><span class="o">-</span><span class="nx">mac</span><span class="o">-</span><span class="nx">address</span><span class="p">]</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">macAddress</span> <span class="p">[</span><span class="kd">get</span> <span class="nx">$i</span> <span class="nx">mac</span><span class="o">-</span><span class="nx">address</span><span class="p">]</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">hostname</span> <span class="p">[</span><span class="kd">get</span> <span class="nx">$i</span> <span class="nx">host</span><span class="o">-</span><span class="nx">name</span><span class="p">]</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">ipAddr</span> <span class="p">[</span><span class="kd">get</span> <span class="nx">$i</span> <span class="nx">address</span><span class="p">]</span>
    <span class="p">:</span><span class="nx">local</span> <span class="nx">queueName</span> <span class="dl">"</span><span class="s2">Client - $macAddress</span><span class="dl">"</span>

   <span class="p">:</span><span class="k">if</span> <span class="p">(</span><span class="nx">$hostname</span> <span class="o">~</span> <span class="nx">$vipDevices</span><span class="o">=</span> <span class="kc">true</span><span class="p">)</span> <span class="k">do</span><span class="o">=</span><span class="p">{</span>
     <span class="o">/</span><span class="nx">queue</span> <span class="nx">simple</span> <span class="nx">add</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">$queueName</span><span class="dl">"</span> <span class="nx">comment</span><span class="o">=</span><span class="dl">"</span><span class="s2">$hostname</span><span class="dl">"</span> <span class="nx">target</span><span class="o">=</span><span class="dl">"</span><span class="s2">$ipAddr</span><span class="dl">"</span> <span class="nx">max</span><span class="o">-</span><span class="nx">limit</span><span class="o">=</span><span class="dl">"</span><span class="s2">$vipLimit</span><span class="dl">"</span>
   <span class="p">}</span> <span class="k">else</span><span class="o">=</span><span class="p">{</span>
     <span class="o">/</span><span class="nx">queue</span> <span class="nx">simple</span> <span class="nx">add</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">$queueName</span><span class="dl">"</span> <span class="nx">comment</span><span class="o">=</span><span class="dl">"</span><span class="s2">$hostname</span><span class="dl">"</span> <span class="nx">target</span><span class="o">=</span><span class="dl">"</span><span class="s2">$ipAddr</span><span class="dl">"</span> <span class="nx">max</span><span class="o">-</span><span class="nx">limit</span><span class="o">=</span><span class="dl">"</span><span class="s2">$pcLimit</span><span class="dl">"</span>
   <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> </main> <footer class="space-y-3 text-sm text-center"> <p> Contact me at <a href="mailto:tarellel@gmail.com">tarellel@gmail.com</a> <p/> <p> &copy; 2004 - 2023 Brandon Hicks - All rights reserved.<br> Content on this site is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons 4.0 License</a>.<br> Code samples and snippets are licensed under the <a href="https://github.com/tarellel/theworkaround.com/blob/main/LICENSE">MIT License</a> </p> </footer> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-41384218-1"></script> <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-41384218-1');
    </script> </body> </html>